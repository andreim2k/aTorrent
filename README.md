# aTorrent BitTorrent Client

A self-hosted BitTorrent client with a modern web interface. Stream, download, and manage torrents directly from your browser.

## Features

- üåê Web-based UI for easy access from any device
- ‚ö° Real-time torrent status and statistics
- üìä Bandwidth monitoring and speed controls
- üé¨ Media metadata integration (TMDB)
- üîí Secure authentication with JWT tokens
- üì± Responsive design
- üõ†Ô∏è Systemd service support for easy management

## Requirements

- Node.js 22+
- npm 10+
- Linux (systemd optional but recommended)

## Installation

### Quick Install (Recommended)

```bash
sudo bash install.sh
```

This will:
1. Install system dependencies (Node.js, build tools)
2. Install npm packages
3. Build the application
4. Generate JWT secret
5. Create data directories
6. Setup systemd service (if running as root)

### Manual Installation

```bash
npm install
npm run build
mkdir -p data/downloads
cp .env.example .env
# Edit .env as needed
```

## Configuration

Edit `.env` to configure the application:

```env
# Server
PORT=3001
HOST=0.0.0.0

# Security
JWT_SECRET=<auto-generated or custom>

# CORS Configuration (important for remote access)
# Leave empty for development mode (allows all origins)
# For production, specify allowed origins as comma-separated URLs:
# CORS_ORIGIN=http://localhost:3001,http://192.168.1.100:3001,http://example.com:3001
CORS_ORIGIN=

# Torrent Peer Port (for port forwarding / connectability)
TORRENT_PORT=6881

# Paths
DOWNLOADS_DIR=/media/Downloads
TMDB_API_KEY=<optional>

# Environment
NODE_ENV=production
```

### CORS Configuration

If you're accessing the app from a different hostname/IP than localhost, you must configure `CORS_ORIGIN`:

**Development (allows all):**
```env
NODE_ENV=development
CORS_ORIGIN=
```

**Production (specific hosts):**
```env
NODE_ENV=production
CORS_ORIGIN=http://poseidon:3001,http://192.168.1.100:3001,http://100.121.236.102:3001
```

## Usage

### Start the Application

**Using the management script:**
```bash
./atorrent.sh start
```

**Using systemd (if installed):**
```bash
sudo systemctl start atorrent
systemctl status atorrent
```

**Manual start:**
```bash
source .env
node dist/server/index.js
```

### Stop the Application

```bash
./atorrent.sh stop
```

Or with systemd:
```bash
sudo systemctl stop atorrent
```

### View Logs

```bash
./atorrent.sh logs
```

Or with systemd:
```bash
sudo journalctl -u atorrent -f
```

### Development

**Backend:**
```bash
npm run dev
```

**Frontend:**
```bash
npm run dev:client
```

**Both (dev servers):**
```bash
./atorrent.sh dev
./atorrent.sh dev:stop
```

## Accessing the Application

Once running, access the web interface at:

- http://localhost:3001 (local)
- http://{hostname}:3001 (network)
- http://{ip-address}:3001 (direct IP)

## Database

SQLite database is automatically created at `data/atorrent.db` on first run. No manual setup needed.

To reset the database:
```bash
rm data/atorrent.db
./atorrent.sh start
```

## Management

### Available Commands

```bash
./atorrent.sh start      # Start server
./atorrent.sh stop       # Stop server
./atorrent.sh restart    # Restart server
./atorrent.sh status     # Show status
./atorrent.sh logs       # View logs
./atorrent.sh build      # Rebuild application
./atorrent.sh dev        # Start dev servers
./atorrent.sh dev:stop   # Stop dev servers
```

### Systemd Service

If systemd is enabled:

```bash
sudo systemctl start atorrent      # Start
sudo systemctl stop atorrent       # Stop
sudo systemctl restart atorrent    # Restart
sudo systemctl status atorrent     # Status
sudo systemctl enable atorrent     # Auto-start on boot
sudo systemctl disable atorrent    # Disable auto-start
```

## Troubleshooting

### Assets not loading (500 errors)

**Problem:** JavaScript/CSS files return 500 errors

**Solution:** Check CORS_ORIGIN configuration in `.env`

```env
# For remote access, set CORS_ORIGIN to your access URL
CORS_ORIGIN=http://192.168.1.100:3001
```

Then restart:
```bash
./atorrent.sh restart
```

### Port Forwarding (Connectability)

To be connectable (important for upload/download performance), you need to forward the torrent peer port in your router:

1. Set `TORRENT_PORT` in `.env` (default: `6881`)
2. Forward that port (TCP + UDP) in your router to your machine's LAN IP
3. On Linux, open the port in your firewall:
   ```bash
   sudo ufw allow 6881/tcp
   sudo ufw allow 6881/udp
   ```
4. Verify at https://www.yougetsignal.com/tools/open-ports/ using your chosen port

### Port already in use

Change `PORT` in `.env`:
```env
PORT=3002
```

### Database errors

Ensure `data` directory exists and is writable:
```bash
mkdir -p data/downloads
chmod 755 data
```

### Connection refused

Check if server is running:
```bash
./atorrent.sh status
```

View logs for errors:
```bash
./atorrent.sh logs
```

## Project Structure

```
aTorrent/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ server/          # Express.js backend
‚îÇ   ‚îú‚îÄ‚îÄ client/          # React frontend
‚îÇ   ‚îî‚îÄ‚îÄ types/           # TypeScript definitions
‚îú‚îÄ‚îÄ dist/                # Compiled output
‚îú‚îÄ‚îÄ data/                # SQLite DB and downloads
‚îú‚îÄ‚îÄ public/              # Static assets
‚îú‚îÄ‚îÄ install.sh           # Installation script
‚îú‚îÄ‚îÄ atorrent.sh          # Management script
‚îú‚îÄ‚îÄ atorrent.service     # Systemd service
‚îî‚îÄ‚îÄ package.json         # Dependencies
```

## Development

### Tech Stack

- **Backend:** Node.js, Fastify, SQLite (Drizzle ORM)
- **Frontend:** React, Vite, TailwindCSS
- **Real-time:** WebSockets
- **Package:** WebTorrent

### Build Commands

```bash
npm run build           # Full build (client + server)
npm run dev             # Watch server files
npm run dev:client      # Watch client files
npm run db:generate     # Generate DB migrations
npm run db:migrate      # Run DB migrations
```

## License

See LICENSE file for details.

## Support

For issues, questions, or feature requests, please refer to the project documentation or logs.
